(function(){var MONGO_LOG_SERVER_URL,MongoClient,SERVER_VERSION,accessControl,asyncAdmin,dashboardRenderer,express,fs,http,https,main,mongodb,sessionHandler,startup,url;SERVER_VERSION={major:0,minor:1,codename:"Test",status:"ok - incomplete",system_name:"webservice (coffee v0.1)"};https=require("https");http=require("http");mongodb=require("mongodb");url=require("url");fs=require("fs");express=require("express");sessionHandler=require("./session_handler.js");accessControl=require("./access.js");asyncAdmin=require("./async/asyncAdmin.js");dashboardRenderer=require("./active_pages/dashboard.js");MongoClient=mongodb.MongoClient;MONGO_LOG_SERVER_URL="mongodb://localhost:27017/log";startup=function(ver){return MongoClient.connect(MONGO_LOG_SERVER_URL,function(err,db){var d;if(err){throw err}d={time:Date.now(),version:ver};return db.collection("startup").insertOne(d,function(err,res){if(err){throw err}return db.close})})};main=function(){var expressApp;expressApp=express();expressApp.use(express["static"]("public"));expressApp.use("/static",express["static"]("static"));expressApp.use("/data/begin-session",sessionHandler.InitiateSession);expressApp.use("/data/end-session",sessionHandler.EndSession);expressApp.use(sessionHandler.ValidateSession);expressApp.get("/dashboard",dashboardRenderer.render);expressApp.use("/admin*",accessControl.controlLevel.admin);expressApp.get("/admin/users",dashboardRenderer.subpages.renderUserAdmin);expressApp.get("/admin/users/groups/*",dashboardRenderer.subpages.renderUserGroupView);expressApp.get("/admin/async/users/groups/*",asyncAdmin.getGroups);expressApp.get("/admin/async/user/*",asyncAdmin.getUser);expressApp.get("/api/version",function(req,res){var ct;ct={"Content-Type":"application/json"};res.writeHead(200,ct);return res.end(JSON.stringify(SERVER_VERSION))});startup(SERVER_VERSION);return void 0};main()}).call(this);
